# Ochre: Local AI Workspace

Ochre is a local, single-user web application that integrates a chat agent with a unified virtual filesystem to manage local files, todos, email, and Notion boards.

## Core Concepts

### Unified Filesystem (`/fs/...`)
The application exposes all resources through a unified virtual filesystem path:
- **Local Mounts:** `/fs/mnt/<name>/...` (Configured in `backend/config/mounts.json`)
- **Todos:** `/fs/todos/...` (Daily markdown files like `today.md`, `YYYY-MM-DD.md`)
- **Notion:** `/fs/kanban/notion/...` (Virtual filesystem for Boards/Status/Cards)
- **Email:** `/fs/email/...` (Gmail access)

### Agent ("Ochre Agent")
The "Ochre Agent" is an OpenRouter-backed chat assistant running on the backend.
- **Server-Side Tool Calling:** The agent executes tools on the backend (Python).
- **Filesystem Tools:** The agent primarily interacts with the world by reading/writing to the `/fs/` paths (e.g., `fs_read`, `fs_write`, `fs_move`).
- **Resilience:** The backend (`ConversationModel`) maintains chat state, allowing the frontend to disconnect/reconnect without losing context.
- **System Prompt:** Configured in `backend/app/agent/prompt.py`.

### Agent Skills
Capabilities are decentralized into **Skills** provided by VFS providers.
- **Discovery:** The agent discovers skills via the dynamic system prompt (Prelude).
- **Location:** Skills are exposed virtually at `/fs/.../.ochre/skills/<skill_name>/SKILL.md`.
- **Usage:** The agent reads the `SKILL.md` file to learn how to use a specific subsystem.
- **Extensibility:** Users can add custom skills by creating `.ochre/skills/` directories in their local mounts.

## Development Rules

### Startup & Running
When starting the application, **ALWAYS** use the `./go.sh` script at the project root.
This script handles:
- Killing existing processes on ports 8000 and 5173.
- Starting the backend (`uv run uvicorn ...`) and frontend (`npm run dev`) in parallel.
- Setting up the correct environment variables.

**Do not try to start backend or frontend manually unless debugging a specific isolated issue.**

*Note: The frontend runs on another machine and connects via IP address 100.67.177.106.*

### Backend (Python)
- **Dependency Management:** Always use `uv`.
- **Location:** `backend/`
- **Framework:** FastAPI

### Frontend (React)
- **Location:** `frontend/`
- **Framework:** Vite + React

## Codebase Structure
- `backend/app/agent/`: Agent logic, prompt definitions, and runner.
- `backend/app/fs/`: Virtual filesystem providers (local, memory, notion, gmail).
- `backend/app/fs/skills.py`: Skill definitions and mixins.
- `backend/app/todos/`: Todo logic (markdown parsing/rendering).
- `plan.md`: Architectural resilience plan for the chat system.

### Debugging & Test-Driven Development
When bisecting complex bugs, especially those involving frontend/backend interaction or race conditions, follow this TDD process:

1.  **Create Reproduction Test:** Write a Playwright test (e.g., `frontend/e2e/tests/repro_issue.desktop.spec.ts`) that asserts the *correct* behavior.
2.  **Verify Failure:** Run the test to confirm it fails (`npx playwright test e2e/tests/repro_issue.desktop.spec.ts`). This confirms the bug is reproduced.
3.  **Diagnose & Fix:** Analyze logs/traces, apply fixes to the codebase.
4.  **Verify Fix:** Run the test again to confirm it passes.
5.  **Cleanup:** Delete the temporary reproduction test file (unless it is valuable as a permanent regression test).
